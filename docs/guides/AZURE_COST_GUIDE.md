# 🔍 Azure Computer Vision API 成本控制指南

## 📊 免費層級限制

### 基本限制
- **免費額度**：每月 5,000 次交易
- **請求頻率**：每分鐘最多 20 次
- **圖片大小**：最大 4MB
- **支援格式**：JPEG, PNG, GIF, BMP

### 成本結構
- **免費層**：前 5,000 次交易免費
- **付費層**：$1.00 per 1,000 transactions
- **超出免費額度後**：每 1,000 次交易約 $1.00

## 💡 成本優化策略

### 1. 圖片大小優化
```python
# 建議的圖片大小
- 收據圖片：1-2MB
- 最大限制：4MB
- 推薦格式：JPEG（壓縮率較好）
```

### 2. 批量處理優化
- 使用批量上傳功能減少重複請求
- 避免頻繁的單次處理
- 合理設置處理間隔

### 3. 圖片品質控制
- 使用圖片增強功能提高識別準確率
- 避免重複處理同一圖片
- 定期清理無效圖片

## 🚨 使用量監控

### 監控頁面
訪問：http://localhost:8000/static/usage.html

### 關鍵指標
- **月度使用量**：當前月份已使用的API調用次數
- **剩餘額度**：距離免費額度限制的剩餘次數
- **使用量趨勢**：每日使用量變化
- **成本估算**：基於當前使用量的成本預估

### 警告機制
- **80% 警告**：使用量達到免費額度的 80% 時
- **100% 警告**：達到免費額度限制時
- **頻率警告**：超過每分鐘請求限制時

## 📈 使用量預估

### 典型使用場景
| 場景 | 每日收據數量 | 月度API調用 | 成本估算 |
|------|-------------|-------------|----------|
| 個人使用 | 5-10 張 | 150-300 次 | $0 |
| 小型企業 | 20-50 張 | 600-1500 次 | $0 |
| 中型企業 | 100-200 張 | 3000-6000 次 | $0-$1 |
| 大型企業 | 500+ 張 | 15000+ 次 | $10+ |

### 成本控制建議
1. **監控使用量**：定期檢查使用量頁面
2. **優化圖片**：壓縮圖片大小
3. **批量處理**：減少API調用次數
4. **設置警告**：及時收到使用量警告

## 🔧 技術優化

### 圖片壓縮
```python
# 建議的圖片處理流程
1. 檢查圖片大小
2. 如果 > 2MB，進行壓縮
3. 保持圖片品質
4. 使用JPEG格式
```

### 錯誤處理
```python
# 避免重複調用
- 檢查圖片是否已處理
- 實現重試機制
- 記錄失敗的調用
```

### 快取策略
```python
# 實現結果快取
- 相同圖片不重複處理
- 快取識別結果
- 定期清理快取
```

## 📋 最佳實踐

### 1. 定期監控
- 每日檢查使用量
- 設置使用量警告
- 追蹤成本趨勢

### 2. 圖片管理
- 統一圖片格式
- 控制圖片大小
- 定期清理無效圖片

### 3. 處理策略
- 批量處理優先
- 避免重複處理
- 優化處理流程

### 4. 成本控制
- 設置月度預算
- 監控異常使用
- 及時調整策略

## 🆘 超出限制處理

### 當達到免費額度時
1. **檢查使用量**：確認是否真的超出
2. **優化流程**：減少不必要的API調用
3. **考慮升級**：評估付費方案
4. **替代方案**：考慮其他OCR服務

### 付費方案選擇
- **按量付費**：$1.00 per 1,000 transactions
- **預付方案**：大量使用可考慮預付
- **企業方案**：聯繫Azure銷售團隊

## 📞 支援與聯繫

### 監控工具
- 使用量頁面：http://localhost:8000/static/usage.html
- API文檔：http://localhost:8000/docs
- 健康檢查：http://localhost:8000/health

### 成本控制工具
- 自動警告系統
- 使用量趨勢分析
- 成本估算功能

---

**💡 提示**：定期檢查使用量頁面，設置合理的警告閾值，可以有效控制Azure API的使用成本。
